<div class="memory-display">
  <div class="header">
    <h2 class="title">
      <span class="icon">üíæ</span>
      Memory Usage
    </h2>
    <button class="refresh-btn" (click)="refresh()" [disabled]="isLoading">
      <span class="refresh-icon" [class.spinning]="isLoading">üîÑ</span>
      Refresh
    </button>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading memory statistics...</p>
  </div>

  <div *ngIf="error" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="refresh()">Try Again</button>
  </div>

  <div *ngIf="memoryStats$ | async as stats" class="content">
    <!-- Overall Memory Summary -->
    <div class="summary-card">
      <div class="summary-header">
        <h3>Total Memory Usage</h3>
        <span class="percentage">{{ getTotalUsagePercentage(stats).toFixed(1) }}%</span>
      </div>
      
      <div class="summary-bar">
        <div 
          class="summary-fill" 
          [style.width.%]="getTotalUsagePercentage(stats)"
          [style.background-color]="getUsageColor(getTotalUsagePercentage(stats))"
        ></div>
      </div>
      
      <div class="summary-details">
        <div class="detail">
          <span class="label">Used:</span>
          <span class="value">{{ formatBytes(stats.totalUsed) }}</span>
        </div>
        <div class="detail">
          <span class="label">Available:</span>
          <span class="value">{{ formatBytes(stats.totalAvailable) }}</span>
        </div>
        <div class="detail">
          <span class="label">Last Updated:</span>
          <span class="value">{{ stats.lastUpdated | date:'medium' }}</span>
        </div>
      </div>
    </div>

    <!-- Individual Memory Types -->
    <div class="memory-grid">
      <div 
        *ngFor="let memory of stats.memoryTypes" 
        class="memory-card"
        [class]="getUsageLevel(memory.percentage)"
      >
        <div class="memory-header">
          <div class="memory-type">
            <span class="type-name">{{ memory.type }}</span>
            <span class="type-badge" [class]="getUsageLevel(memory.percentage)">
              {{ getUsageLevel(memory.percentage) }}
            </span>
          </div>
          <span class="percentage">{{ memory.percentage.toFixed(1) }}%</span>
        </div>

        <div class="progress-container">
          <div class="progress-bar">
            <div 
              class="progress-fill" 
              [style.width.%]="memory.percentage"
              [style.background-color]="getUsageColor(memory.percentage)"
            ></div>
          </div>
        </div>

        <div class="memory-details">
          <div class="detail-row">
            <span class="label">Used:</span>
            <span class="value">{{ formatBytes(memory.used) }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Total:</span>
            <span class="value">{{ formatBytes(memory.total) }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Free:</span>
            <span class="value">{{ formatBytes(memory.total - memory.used) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>