<div class="devkit-list" [class.dark-theme]="themeType === 'dark'" [class.light-theme]="themeType === 'light'">
  <div class="devkit-list-header">
    <h2>Connected Development Kits</h2>
    <button class="refresh-btn" (click)="refreshDevKits()" title="Refresh" style="background: #f1f5f9; border-radius: 50%; padding: 8px; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
      <mat-icon style="color: #2563eb;">refresh</mat-icon>
    </button>
  </div>
  @if (devkits.length > 0) {
    @for (kit of devkits; track kit.serial) {
      <div class="devkit-card">
        <div class="devkit-header">
          <span class="devkit-name">
            {{ kit.name }}
            @if (kit.name && kit.name.trim().toLowerCase() === 'unknown') {
              <mat-icon class="unknown-icon" matTooltip="This development kit does not support automatic kit identification." fontIcon="help_outline"></mat-icon>
            }
          </span>
          <span class="devkit-serial">SN: {{ kit.serial }}</span>
          <span class="devkit-fw" [ngClass]="{ 'outdated': kit.fwOutOfDate }">
            FW: {{ kit.firmwareVersion }}
            @if (kit.fwOutOfDate) {
              <mat-icon>warning</mat-icon>
              <button class="update-fw-btn" (click)="updateFirmware(kit)" title="Update Firmware">
                Update Firmware
              </button>
            }
          </span>
        </div>
        <div class="devkit-details">
          <div><strong>Features:</strong> {{ kit.boardFeatures.join(', ') }}</div>
          <div><strong>KitProg Type:</strong> {{ kit.kitProgType }}</div>
          <div><strong>USB Mode:</strong> {{ kit.usbMode }}</div>
          <div><strong>Bridging:</strong> {{ kit.bridgingTypes.join(', ') }}</div>
          <!-- BSP Selection with Autocomplete -->
          <div class="bsp-select-row">
            <label><strong>BSP:</strong></label>
            <div class="bsp-autocomplete-wrapper">
              <input 
                type="text"
                class="bsp-input"
                [value]="getBspFilterText(kit)"
                (input)="onBspFilterChange(kit, $any($event.target).value)"
                (focus)="onBspInputFocus(kit)"
                [matAutocomplete]="auto"
                placeholder="Type to filter BSPs..."
                autocomplete="off"
              />
              <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onBspSelected(kit, $event.option.value)" [autoActiveFirstOption]="true">
                @for (bsp of getFilteredBspChoices(kit); track bsp) {
                  <mat-option [value]="bsp">{{ bsp }}</mat-option>
                }
              </mat-autocomplete>
            </div>
          </div>
        </div>
      </div>
    }
  } @else {
    <div class="no-kits">No development kits connected.</div>
  }
</div>
