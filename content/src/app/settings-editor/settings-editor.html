<div class="settings-editor-container" [class.dark-theme]="themeType === 'dark'" [class.light-theme]="themeType === 'light'">
  @for (setting of settings; track setting.name) {
    <div class="setting-row">
      <div class="setting-main">
        <div class="setting-label-group" style="display: flex; align-items: center; min-width: 180px;">
          <label class="setting-label" style="margin-right: 6px;">{{ setting.displayName }}</label>
          <mat-icon class="setting-help-icon" matTooltip="{{ setting.description }}" style="vertical-align: middle; cursor: pointer; color: #1976d2;">help_outline</mat-icon>
        </div>
      @if (setting.type === 'string' && setting.name === 'custompath') {
        <mat-form-field appearance="outline" class="setting-field">
          <input matInput [ngModel]="getCustomPathDisplayValue()" (ngModelChange)="onCustomPathDisplayValueChange($event)" [disabled]="isCustomPathDisabled()" />
          @if (manifestStatus === 'loading') {
            <p class="manifest-loading-message" style="font-size: 0.8em; color: #d26619; margin: 4px 0 0 0;">Manifest files are still loading...</p>
          }               
        </mat-form-field>
      } @else if (setting.type === 'string') {
        <mat-form-field appearance="outline" class="setting-field">
          <input matInput [(ngModel)]="setting.value" (ngModelChange)="onValueChange(setting, $event)" [disabled]="isSettingDisabled(setting)" />
        </mat-form-field>
      } @else if (setting.type === 'number') {
        <mat-form-field appearance="outline" class="setting-field">
          <input matInput type="number" [(ngModel)]="setting.value" (ngModelChange)="onValueChange(setting, $event)" [disabled]="isSettingDisabled(setting)" />
        </mat-form-field>
      } @else if (setting.type === 'boolean') {
        <mat-checkbox [(ngModel)]="setting.value" (change)="onValueChange(setting, $event.checked)" [disabled]="isSettingDisabled(setting)"></mat-checkbox>
      } @else if (setting.name === 'toolsversion' || setting.name === 'enabled_eap') {
        <div class="browse-row" style="flex: 1;">
          <mat-form-field class="setting-field" appearance="outline" style="flex: 1;">
            <mat-label>{{ setting.displayName }}</mat-label>
            <mat-select [(ngModel)]="setting.value" (selectionChange)="onValueChange(setting, $event.value)" [disabled]="manifestStatus === 'loading' || isSettingDisabled(setting)">
              @for (pair of getChoiceTipPairs(setting); track pair.choice) {
                <mat-option [value]="pair.choice" [matTooltip]="pair.tip">
                  {{ setting.mapping ? (setting.mapping[pair.choice] || pair.choice) : pair.choice }}
                </mat-option>
              }
            </mat-select>
            @if (manifestStatus === 'loading') {
              <p class="manifest-loading-message" style="font-size: 0.8em; color: #d26619; margin: 4px 0 0 0;">Manifest files are still loading...</p>
            }
          </mat-form-field>
          <button mat-icon-button matTooltip="{{ setting.description }}" aria-label="Help">
            <mat-icon>help_outline</mat-icon>
          </button>
        </div>
      } @else if (setting.type === 'choice') {
        <div class="browse-row" style="flex: 1;">
          <mat-form-field class="setting-field" appearance="outline" style="flex: 1;">
            <mat-label>{{ setting.displayName }}</mat-label>
            <mat-select [(ngModel)]="setting.value" (selectionChange)="onValueChange(setting, $event.value)" [disabled]="isSettingDisabled(setting)">
              @for (pair of getChoiceTipPairs(setting); track pair.choice) {
                <mat-option [value]="pair.choice" [matTooltip]="pair.tip">
                  {{ setting.mapping ? (setting.mapping[pair.choice] || pair.choice) : pair.choice }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
          <button mat-icon-button matTooltip="{{ setting.description }}" aria-label="Help">
            <mat-icon>help_outline</mat-icon>
          </button>
        </div>
      } @else if (setting.type === 'uri') {
        <mat-form-field appearance="outline" class="setting-field" [color]="isValidUri(setting.value) ? 'primary' : 'warn'">
          <input matInput [(ngModel)]="setting.value" (ngModelChange)="onValueChange(setting, $event)" placeholder="Enter a valid URI" [disabled]="isSettingDisabled(setting)" />
          @if (!isValidUri(setting.value)) {
            <mat-error>Invalid URI</mat-error>
          }
        </mat-form-field>
      } @else if (setting.name === 'custompath') {
        <div class="browse-row" style="flex: 1;">
          <mat-form-field appearance="outline" class="setting-field" style="flex: 1;">
            <input matInput 
                   [ngModel]="getCustomPathDisplayValue()" 
                   [disabled]="isCustomPathDisabled()"
                   (ngModelChange)="onCustomPathDisplayValueChange($event)" />
          </mat-form-field>
          <button mat-icon-button (click)="onBrowseForFolder(setting, 'Custom Tools Path')" matTooltip="Browse for folder" [disabled]="isCustomPathDisabled()">
            <mat-icon>more_horiz</mat-icon>
          </button>
        </div>
        @if (manifestStatus === 'loading') {
          <br>
          <p class="manifest-loading-message" style="font-size: 0.8em; color: #d26619; margin: 4px 0 0 0;">Manifest files are still loading...</p>
        }
      } @else if (setting.type === 'dirpath') {
        <div class="browse-row" style="flex: 1;">
          <mat-form-field appearance="outline" class="setting-field" style="flex: 1;">
            <input matInput 
                   [(ngModel)]="setting.value" 
                   (ngModelChange)="onValueChange(setting, $event)" 
                   [disabled]="isSettingDisabled(setting)" />
          </mat-form-field>
          <button mat-icon-button (click)="onBrowseForFolder(setting, 'Select Folder')" matTooltip="Browse for folder" [disabled]="isSettingDisabled(setting)">
            <mat-icon>more_horiz</mat-icon>
          </button>
        </div>
      } @else if (setting.type === 'filepath') {
        <div class="browse-row" style="flex: 1;">
          <mat-form-field appearance="outline" class="setting-field" style="flex: 1;">
            <input matInput [(ngModel)]="setting.value" (ngModelChange)="onValueChange(setting, $event)" [disabled]="isSettingDisabled(setting)" />
          </mat-form-field>
          <button mat-icon-button (click)="onBrowseForFile(setting)" matTooltip="Browse for file" [disabled]="isSettingDisabled(setting)">
            <mat-icon>more_horiz</mat-icon>
          </button>
        </div>
      }
      </div>
      <!-- Display errors for this setting -->
      @for (error of getErrorsForSetting(setting.name); track error.message) {
        <div class="setting-error">{{ error.message }}</div>
      }
      <!-- Display disabled message if setting is disabled -->
      @if (setting.disabledMessage) {
        <div class="setting-disabled-message">{{ setting.disabledMessage }}</div>
      }
    </div>
  }
</div>
