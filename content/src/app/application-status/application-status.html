<div class="application-status">
  @if (isLoading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading application status...</p>
    </div>
  }

  @if (hasError && !isLoading) {
    <div class="error-state">
      <div class="error-icon">‚ùå</div>
      <p>{{ errorMessage }}</p>
      <button (click)="refresh()" class="retry-button">Retry</button>
    </div>
  }

  @if (!isLoading && !hasError && applicationStatus) {
    <div class="content">
    <mat-tab-group class="status-tabs">
      <!-- Application Information Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>dashboard</mat-icon>
          Application
        </ng-template>
        
        <div class="tab-content">
          <!-- Application Overview -->
          <div class="overview-section">
            <div class="app-info">
              <h3>{{ applicationStatus.name }}</h3>
              <div class="details">
                <span class="version">Application Status</span>
                <span class="status" [class]="applicationStatus.valid ? 'running' : 'error'">
                  {{ applicationStatus.valid ? 'Valid' : 'Invalid' }}
                </span>
              </div>
              <p class="build-date">Status checked: {{ currentDate | date:'medium' }}</p>
              
              <!-- Application Build Actions -->
              <div class="app-build-actions">
                <button mat-raised-button class="app-build-btn build-btn" (click)="buildApplication()">
                  <mat-icon>build</mat-icon>
                  Build
                </button>
                <button mat-raised-button class="app-build-btn rebuild-btn" (click)="rebuildApplication()">
                  <mat-icon>refresh</mat-icon>
                  Rebuild
                </button>
                <button mat-raised-button class="app-build-btn clean-btn" (click)="cleanApplication()">
                  <mat-icon>cleaning_services</mat-icon>
                  Clean
                </button>
                <button mat-raised-button class="app-build-btn erase-btn" (click)="eraseApplication()">
                  <mat-icon>delete</mat-icon>
                  Erase
                </button>
                <button mat-raised-button class="app-build-btn program-btn" (click)="programApplication()">
                  <mat-icon>download</mat-icon>
                  Program
                </button>
              </div>
            </div>
          </div>

          <!-- Memory Usage Section -->
          <div class="memory-section">
            <h3>Memory Usage</h3>
            <div class="memory-grid">
              @for (memory of applicationStatus.memory; track memory.type) {
                <div class="memory-item">
                  <div class="memory-header">
                    <span class="memory-type">{{ memory.type }}</span>
                    <span class="percentage">{{ memory.percentage.toFixed(1) }}%</span>
                  </div>
                  <div class="progress-bar">
                    <div 
                      class="progress-fill" 
                      [style.width.%]="memory.percentage"
                      [style.background-color]="getMemoryColorHex(memory.percentage)"
                    ></div>
                  </div>
                  <div class="memory-details">
                    <span class="used">{{ formatBytes(memory.used) }}</span>
                    <span class="total">/ {{ formatBytes(memory.total) }}</span>
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Application Documentation Section -->
          <div class="documentation-section">
            <h3 class="collapsible-header" (click)="toggleSection('application', 'documentation')">
              <mat-icon class="collapse-icon" [class.collapsed]="isSectionCollapsed('application', 'documentation')">
                expand_more
              </mat-icon>
              Application Documentation
            </h3>
            <div class="doc-grid" [class.collapsed]="isSectionCollapsed('application', 'documentation')">
              @for (doc of applicationStatus.documentation; track doc.name) {
                <div class="doc-item" (click)="openDocument(doc)">
                  <div class="doc-info">
                    <h4>{{ doc.name }}</h4>
                  </div>
                </div>
              }
            </div>
          </div>

          <div class="tools-section">
            <h3 class="collapsible-header" (click)="toggleSection('application', 'tools')">
              <mat-icon class="collapse-icon" [class.collapsed]="isSectionCollapsed('application', 'tools')">
                expand_more
              </mat-icon>
              Application Tools
            </h3>
            <div class="tools-grid" [class.collapsed]="isSectionCollapsed('application', 'tools')">
              @for (tool of applicationStatus.tools; track tool.name) {
                <div class="tool-item">
                  <div class="tool-header">
                    <div class="tool-info">
                      <h4 style="color: black;">{{ tool.name }}</h4>
                      @if (tool.version) {
                        <div class="tool-meta">
                          <span class="version">v{{ tool.version }}</span>
                        </div>
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      </mat-tab>

      <!-- Project Tabs -->
      @for (project of applicationStatus.projects; track project.name) {
        <mat-tab>
          <ng-template mat-tab-label>
            <span>üì¶</span>
            {{ project.name }}
          </ng-template>
        
        <div class="tab-content">
          <!-- Project Overview -->
          <div class="project-overview">
            <div class="project-info">
              <h3>{{ project.name }}</h3>
              <!-- Project details (version, type, status, last build) removed as requested -->
              
              <!-- Project Build Actions -->
              <div class="project-build-actions">
                <button mat-raised-button class="project-build-btn build-btn" (click)="buildProject(project)">
                  <mat-icon>build</mat-icon>
                  Build
                </button>
                <button mat-raised-button class="project-build-btn rebuild-btn" (click)="rebuildProject(project)">
                  <mat-icon>refresh</mat-icon>
                  Rebuild
                </button>
                <button mat-raised-button class="project-build-btn clean-btn" (click)="cleanProject(project)">
                  <mat-icon>cleaning_services</mat-icon>
                  Clean
                </button>
                <button mat-raised-button class="project-build-btn program-btn" (click)="programProject(project)">
                  <mat-icon>download</mat-icon>
                  Program
                </button>
              </div>
              
              <!-- Missing Assets Indicator -->
              @if (hasMissingAssets(project)) {
                <div class="missing-assets-indicator">
                  <div class="warning-badge">
                    <mat-icon class="warning-icon">warning</mat-icon>
                    <span class="warning-text">Missing Assets</span>
                  </div>
                  <div class="missing-actions">
                    <button 
                      class="fix-assets-button" 
                      [disabled]="isFixingAssets(project)"
                      (click)="fixMissingAssets(project)">
                      @if (isFixingAssets(project)) {
                        <mat-icon>hourglass_empty</mat-icon>
                        Running...
                      } @else {
                        <mat-icon>build</mat-icon>
                        Fix Missing Assets
                      }
                    </button>
                    @if (isFixingAssets(project) && getCurrentlyLoadingAsset(project)) {
                      <div class="loading-asset-indicator">
                        <div class="loading-spinner"></div>
                        <span class="loading-text">Loading: {{ getCurrentlyLoadingAsset(project) }}</span>
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Project Documentation -->
          <div class="documentation-section">
            <h3 class="collapsible-header" (click)="toggleSection(project.name, 'documentation')">
              <mat-icon class="collapse-icon" [class.collapsed]="isSectionCollapsed(project.name, 'documentation')">
                expand_more
              </mat-icon>
              Project Documentation
            </h3>
            <div class="doc-grid" [class.collapsed]="isSectionCollapsed(project.name, 'documentation')">
              @for (doc of project.documentation; track doc.name) {
                <div class="doc-item" (click)="openDocument(doc)">
                  <div class="doc-info">
                    <h4>{{ doc.name }}</h4>
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Project Middleware -->
          <div class="middleware-section">
            <h3 class="collapsible-header" (click)="toggleSection(project.name, 'middleware')">
              <mat-icon class="collapse-icon" [class.collapsed]="isSectionCollapsed(project.name, 'middleware')">
                expand_more
              </mat-icon>
              Project Middleware
            </h3>
            <div class="middleware-grid" [class.collapsed]="isSectionCollapsed(project.name, 'middleware')">
              @for (middleware of project.middleware; track middleware.name) {
                <div class="middleware-item" [class.missing-middleware]="isMiddlewareMissing(project, middleware.name)" (click)="onMiddlewareClick(project, middleware)">
                  <div class="middleware-header">
                    <div class="middleware-info">
                      <h4>{{ middleware.name }}</h4>
                      <span class="version">{{ middleware.version }}</span>
                      @if (middleware.newer) {
                        <div class="newer-version-indicator">
                          <mat-icon class="newer-icon">update</mat-icon>
                          <span class="newer-text">Update Available</span>
                        </div>
                      }
                      @if (isMiddlewareMissing(project, middleware.name)) {
                        <div class="missing-indicator">
                          <mat-icon class="missing-icon">warning</mat-icon>
                          <span class="missing-text">Missing</span>
                        </div>
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Project Tools -->
          <div class="tools-section">
            <h3 class="collapsible-header" (click)="toggleSection(project.name, 'tools')">
              <mat-icon class="collapse-icon" [class.collapsed]="isSectionCollapsed(project.name, 'tools')">
                expand_more
              </mat-icon>
              Tools
            </h3>
            <div class="tools-grid" [class.collapsed]="isSectionCollapsed(project.name, 'tools')">
              @for (tool of project.tools; track tool.name) {
                <div class="tool-item">
                  <div class="tool-header">
                    <div class="tool-info">
                      <div class="tool-name">
                        <h4>{{ tool.name }}</h4>
                      </div>
                      <div class="tool-meta">
                        <span class="version">v{{ tool.version }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      </mat-tab>
      }
    </mat-tab-group>
    </div>
  }
  @else {
    <div class="no-status">
      <mat-icon>info</mat-icon>
      <p>No application status available.</p>
    </div>
  }
</div>
